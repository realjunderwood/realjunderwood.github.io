<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="index.css">
</head>
<body>
<div id="header">
<h1 id="header">
    FaceMusic
</h1>
</div>
<hr>

<h2>We like to listen to music that matches our mood. But there's a problem with this: First, identifying how happy or sad you are requires a great deal of emotional intelligence. Second, even if you can do this, you can't possibly keep track of your msuci. </h2>
<h2>FaceMusic solves this by identifying how happy or sad you are from a picture of your face -- no emotional intelligence required. From there, FaceMusic identifies your favorite songs and makes a playlist of those songs that best match your mood.</h2>


<h1 onclick="generateCodeChallenge(64)">Connect with spotify to get started.</h1>



<h1>How it works</h1>
<p>Explain the tech very briefly</p>

<script src="spotify_auth.js"></script>
<script>
    const clientId = 'b5ac45b92b3243668cdb8390ab51a04d';
    const redirectUri = 'https://www.jamesunderwood.net/facemusic';

    const scope = 'user-top-read';
    const authUrl = new URL("https://accounts.spotify.com/authorize")



  

    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("code")) {
        console.log("It has been detected that you needa login rn")
        let code = urlParams.get("code");
        let codeVerifier = localStorage.getItem('code_verifier');
        console.log("uhhhsadf hey");
        getToken(code).then((value) => {
            console.log("uhhh hey");
            window.location.href = "https://www.jamesunderwood.net/facemusic";
        });
    }



    if (urlParams.get("error")) {
        // say there was an error and remove url param
    }
    if (localStorage.getItem("access_token")) {




        let accessToken = localStorage.getItem("access_token");
        console.log("YOOO there is an acecss token and it is " + accessToken);
        
        getMusic(accessToken);


    }













    async function getMusic(accessToken) {

        tracksPool = [];

        for (i = 0; i < 2; i++) {
            await getTopArtists(accessToken,49*i).then((value) => {
                //console.log(value);
                // To implement: add to tracksPool top 5 songs of all the top artists

            });

            await getTopTracks(accessToken,49*i).then((value) => {
                //console.log(value);
                for (i=0;i<50;i++) {
                    tracksPool.push(value[i]);
                }


        
        });
        }


        
        comSepList = "";
        for (i=0; i<50; i++) {
              //  console.log(i);
                //console.log(tracksPool[i]);
            comSepList += (i == 0) ? tracksPool[i].id : "," + tracksPool[i].id; //append id to comSepList, with a comma preceding it if it's not the first element
        }

        audFeatures = await getAudioFeatures(accessToken,comSepList);

        audFeatures.sort(compareSongs)
           
 



    }




    function compareSongs(a,b) {
        if (a.valence > b.valence) {
            return 1;
        }
        if (a.valence < b.valence) {
            return -1;
        }
        return 0;
    }




</script>
</body>
</html>